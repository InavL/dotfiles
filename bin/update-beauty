#!/bin/bash

magenta='\e[1;35m'
white='\e[0;37m'

CMD="$1"

printusage() {
    prog=$(basename "$0")
    echo "Usage: $prog [-option]" >&2
    echo "" >&2
    echo "Options:" >&2
    echo "    --help    Print this message" >&2
    echo "    -a        Update all packages" >&2
}

oh-my-zsh() {
    echo -e $magenta"\n Updating Oh My Zsh... \n"$white
    /bin/sh ~/.oh-my-zsh/tools/upgrade.sh
}

dircolors() {
    echo -e $magenta"\n Updating .dircolors... \n"$white
    wget https://raw.githubusercontent.com/seebi/dircolors-solarized/master/dircolors.ansi-light -O ~/.dircolors
}

arc-theme() {
    echo -e $magenta"\n Updating Arc Theme... \n"$white
    cd ~/Temporary
    sudo rm -rf /usr/share/themes/{Arc,Arc-Darker,Arc-Dark}
    git clone https://github.com/horst3180/arc-theme --depth 1 && cd arc-theme
    ./autogen.sh --prefix=/usr --disable-cinnamon --disable-gnome-shell --disable-unity --disable-xfwm
    sudo make install
    cd ~/Temporary
    rm -rf arc-theme
}

base16-shell() {
    echo -e $magenta"\n Updating base16-shell... \n"$white
    cd ~/.config/base16-shell
    git pull
    ./colortest
}

i3-gaps() {
    echo -e $magenta"\n Updating i3-gaps... \n"$white
    cd ~/.local/src/i3-gaps
    git pull
    autoreconf --force --install
    rm -rf build
    mkdir build
    cd build
    ../configure --prefix=/usr --sysconfdir=/etc --disable-sanitizers
    make
    sudo make install
}

i3blocks() {
    echo -e $magenta"\n Updating i3blocks... \n"$white
    cd ~/.local/src/i3blocks
    git pull
    make clean all
    sudo make PREFIX=/usr install
}

i3lock-fancy() {
    echo -e $magenta"\n Updating i3lock & i3lock-fancy... \n"$white
    cd ~/.local/src/i3lock-color
    git pull
    make clean
    make
    sudo make install
    cd ~/.local/src/i3lock-fancy
    git pull
}

dunst() {
    echo -e $magenta"\n Updating dunst... \n"$white
    cd ~/.local/src/dunst
    git pull
    make clean
    make
    sudo make PREFIX=/usr install
}

# Print help message.
if [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]]; then
    printusage
    exit 1
fi

# Update one by one.
if [[ -z "$1" ]]; then
    echo
    read -r -p "Do you want to update oh-my-zsh? [y/n] " response
    case $response in
        [yY][eE][sS]|[yY])
            oh-my-zsh
            ;;
        *)
            echo "Cancelled."
            ;;
    esac

    echo
    read -r -p "Do you want to update .dircolors? [y/n] " response
    case $response in
        [yY][eE][sS]|[yY])
            dircolors
            ;;
        *)
            echo "Cancelled."
            ;;
    esac

    echo
    read -r -p "Do you want to update arc-theme? [y/n] " response
    case $response in
        [yY][eE][sS]|[yY])
            arc-theme
            ;;
        *)
            echo "Cancelled."
            ;;
    esac

    echo
    read -r -p "Do you want to update base16-shell? [y/n] " response
    case $response in
        [yY][eE][sS]|[yY])
            base16-shell
            ;;
        *)
            echo "Cancelled."
            ;;
    esac

    echo
    read -r -p "Do you want to update i3-gaps? [y/n] " response
    case $response in
        [yY][eE][sS]|[yY])
            i3-gaps
            ;;
        *)
            echo "Cancelled."
            ;;
    esac

    echo
    read -r -p "Do you want to update i3blocks? [y/n] " response
    case $response in
        [yY][eE][sS]|[yY])
            i3blocks
            ;;
        *)
            echo "Cancelled."
            ;;
    esac

    echo
    read -r -p "Do you want to update i3lock & i3lock-fancy? [y/n] " response
    case $response in
        [yY][eE][sS]|[yY])
            i3lock-fancy
            ;;
        *)
            echo "Cancelled."
            ;;
    esac

    echo
    read -r -p "Do you want to update dunst? [y/n] " response
    case $response in
        [yY][eE][sS]|[yY])
            dunst
            ;;
        *)
            echo "Cancelled."
            exit 0;
            ;;
    esac
fi

# Update all packages.
case "$CMD" in
    -a)
        oh-my-zsh
        dircolors
        arc-theme
        base16-shell
        i3-gaps
        i3blocks
        i3lock-fancy
        dunst
        exit 1
        ;;
    *)
        exit 1
        ;;
esac
